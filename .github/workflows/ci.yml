name: CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test-compatibility:
    name: Test Browser Compatibility
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Check ES6+ compatibility
      run: |
        echo "Checking for modern JavaScript features..."
        if grep -q "async\|await\|const\|let\|=>" index.js; then
          echo "Modern JavaScript features detected (ES6+)"
        fi

    - name: Check for eval usage (security)
      run: |
        if grep -q "eval(" index.js; then
          echo "Warning: eval() usage detected - potential security risk"
          exit 0
        else
          echo "No eval() usage detected"
        fi

  build-info:
    name: Build Information
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Display project info
      run: |
        echo "Project: VibeFoxes - Vibe Coding App"
        echo "Authors: JULES FRANCOIS, MARTZ CEDRIC"
        echo "Year: 2025"
        echo "Theme: Fox-inspired AI code generator"
        echo ""
        echo "Project Statistics:"
        wc -l index.js
        echo ""
        echo "API Integrations:"
        grep -o "openai\|puter" index.js | sort | uniq -c || true

    - name: Check PUTER_AVAILABLE configuration
      run: |
        echo "Checking PUTER_AVAILABLE configuration..."
        if grep -q "const PUTER_AVAILABLE = true" index.js; then
          echo "PUTER_AVAILABLE = true (local testing mode)"
        fi

  deployment-ready:
    name: Deployment Ready Check
    runs-on: ubuntu-latest
    needs: [test-compatibility]

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Verify deployment files
      run: |
        echo "Checking deployment readiness..."
        if [ -f "index.html" ]; then
          echo "index.html exists"
        else
          echo "index.html not found (may be using document.write)"
        fi

        if [ -f "index.js" ]; then
          echo "index.js exists"
        fi

        if [ -f "package.json" ]; then
          echo "package.json exists"
        fi

    - name: Success notification
      run: |
        echo "All checks passed! Project is ready for deployment."
        echo "VibeFoxes CI/CD pipeline completed successfully!"
